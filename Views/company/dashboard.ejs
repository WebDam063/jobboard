<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/main.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <%- include('../partials/header-pro') %>
    
    <div class="container" style="padding: 2rem;">
        <div class="dashboard-header" style="margin-bottom: 2rem;">
            <h1 style="font-size: 32px; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">
                Tableau de bord
            </h1>
            <p style="color: var(--gray-600); font-size: 16px;">
                Bienvenue <%= user.companyName ? user.companyName : '' %>
            </p>
        </div>

        <% if (success) { %>
            <div class="alert alert-success" style="margin-bottom: 2rem;"><%= success %></div>
        <% } %>
        <% if (error) { %>
            <div class="alert alert-error" style="margin-bottom: 2rem;"><%= error %></div>
        <% } %>

        <!-- Statistiques -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--primary-light);">
                    <i data-lucide="briefcase" style="color: var(--primary);"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Offres actives</p>
                    <h2 class="stat-value"><%= stats.activeAds %> / <%= stats.totalAds %></h2>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(73, 190, 170, 0.1);">
                    <i data-lucide="users" style="color: var(--secondary);"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Candidatures totales</p>
                    <h2 class="stat-value"><%= stats.totalApplications %></h2>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(238, 184, 104, 0.1);">
                    <i data-lucide="clock" style="color: var(--warning);"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">En attente</p>
                    <h2 class="stat-value"><%= stats.pendingApplications %></h2>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(239, 118, 122, 0.1);">
                    <i data-lucide="trending-up" style="color: var(--accent);"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Taux de réponse</p>
                    <h2 class="stat-value"><%= stats.totalApplications > 0 ? Math.round((stats.totalApplications - stats.pendingApplications) / stats.totalApplications * 100) : 0 %>%</h2>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 2rem;">
            <!-- Dernières offres -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i data-lucide="briefcase"></i>
                        Dernières offres
                    </h2>
                    <a href="/company/advertisements" class="btn btn-outline btn-sm">Voir tout</a>
                </div>
                <div class="card-body">
                    <% if (recentAds.length === 0) { %>
                        <p style="color: var(--gray-500); text-align: center; padding: 2rem;">Aucune offre pour le moment</p>
                    <% } else { %>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <% recentAds.forEach(ad => { %>
                                <div style="padding: 1rem; border: 1px solid var(--gray-200); border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900); margin-bottom: 0.25rem;">
                                            <%= ad.title %>
                                        </h3>
                                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                                            <span class="job-badge"><i data-lucide="map-pin" style="width: 12px; height: 12px;"></i> <%= ad.location || 'Non spécifié' %></span>
                                            <span class="badge <%= ad.is_active ? 'badge-success' : 'badge-gray' %>">
                                                <%= ad.is_active ? 'Active' : 'Inactive' %>
                                            </span>
                                        </div>
                                    </div>
                                    <a href="/company/advertisements/<%= ad.id %>/edit" class="btn btn-outline btn-sm">Modifier</a>
                                </div>
                            <% }); %>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Dernières candidatures -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i data-lucide="users"></i>
                        Dernières candidatures
                    </h2>
                    <a href="/company/applications" class="btn btn-outline btn-sm">Voir tout</a>
                </div>
                <div class="card-body">
                    <% if (recentApplications.length === 0) { %>
                        <p style="color: var(--gray-500); text-align: center; padding: 2rem;">Aucune candidature pour le moment</p>
                    <% } else { %>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <% recentApplications.forEach(app => { %>
                                <div style="padding: 1rem; border: 1px solid var(--gray-200); border-radius: 6px;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                        <div>
                                            <h3 style="font-size: 15px; font-weight: 600; color: var(--gray-900);">
                                                <%= app.first_name %> <%= app.last_name %>
                                            </h3>
                                            <p style="font-size: 14px; color: var(--gray-600); margin-top: 0.25rem;">
                                                <%= app.advertisement_title %>
                                            </p>
                                        </div>
                                        <span class="badge <%= app.status === 'pending' ? 'badge-warning' : app.status === 'accepted' ? 'badge-success' : 'badge-error' %>">
                                            <%= app.status === 'pending' ? 'En attente' : app.status === 'accepted' ? 'Acceptée' : 'Refusée' %>
                                        </span>
                                    </div>
                                    <a href="/company/applications/<%= app.id %>" class="btn btn-outline btn-sm" style="width: 100%;">Voir les détails</a>
                                </div>
                            <% }); %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <div style="margin-top: 2rem; text-align: center;">
            <a href="/company/advertisements/new" class="btn btn-primary btn-lg">
                <i data-lucide="plus" style="width: 20px; height: 20px;"></i>
                Créer une nouvelle offre
            </a>
        </div>
    </div>

    <script src="/js/page-loader.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>
</html>

